<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RayVid Admin | Approval System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-[#0a0a0a] text-white min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-10">
            <h1 class="text-3xl font-black text-red-600 tracking-widest italic">RAYVID ADMIN</h1>
            <a href="rayvid.html" class="text-gray-500 hover:text-white transition">Back to Site</a>
        </div>

        <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
            <span class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></span> 
            Pending Approvals
        </h2>

        <div id="pending-container" class="space-y-4">
            </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAoZdkD0PZz25lIVrNy3hQE2fBrkHELs2Q",
            authDomain: "rayvid-c074a.firebaseapp.com",
            projectId: "rayvid-c074a",
            storageBucket: "rayvid-c074a.firebasestorage.app",
            messagingSenderId: "970771885312",
            appId: "1:970771885312:web:104ae741f28287a01ad7e5",
            measurementId: "G-LDBSZRRPQL"
        }; 
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        db.collection("pending_videos").orderBy("createdAt", "desc").onSnapshot(snap => {
            const container = document.getElementById('pending-container');
            container.innerHTML = snap.empty ? '<p class="text-gray-600">No videos to review.</p>' : '';
            
            snap.forEach(doc => {
                const data = doc.data();
                container.innerHTML += `
                    <div class="bg-[#161616] p-6 rounded-2xl border border-gray-800 flex justify-between items-center">
                        <div class="flex gap-4 items-center">
                            <div class="w-24 h-16 bg-black rounded-lg border border-gray-700 flex items-center justify-center">
                                <i class="fa-solid fa-film text-gray-700"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold">${data.title}</h3>
                                <p class="text-sm text-gray-500">By ${data.userName}</p>
                                <a href="${data.url}" target="_blank" class="text-xs text-blue-500 hover:underline mt-1 block">Verify Link</a>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="decide('${doc.id}', true)" class="bg-green-600 hover:bg-green-500 px-6 py-2 rounded-lg font-bold text-sm transition">Approve</button>
                            <button onclick="decide('${doc.id}', false)" class="bg-red-600 hover:bg-red-500 px-6 py-2 rounded-lg font-bold text-sm transition">Delete</button>
                        </div>
                    </div>`;
            });
        });

        async function decide(id, approved) {
            const ref = db.collection("pending_videos").doc(id);
            if(approved) {
                const doc = await ref.get();
                await db.collection("videos").add(doc.data());
            }
            await ref.delete();
            alert(approved ? "Video Published!" : "Video Rejected.");
        }
    </script>
</body>
</html>
